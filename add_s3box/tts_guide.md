# 🔊 ESP32-S3 BOX: Dynamic TTS 실전 가이드

이 문서는 서버에서 보낸 텍스트 데이터를 S3 BOX가 어떻게 음성으로 변환하는지에 대한 기술적 상세 가이드를 제공합니다.

## 1. 서버 측 구현 (Python)
서버는 복잡한 음성 처리를 하지 않습니다. 오직 **텍스트**와 **메타데이터**만 JSON으로 만들어 MQTT로 발송합니다.

*   **코드 위치**: `add_s3box/s3box_ai_manager.py`
*   **전송 규격**:
    ```json
    {
      "type": "tts",
      "text": "서울 농장 1번 구역의 습도가 낮습니다. 물을 보충해 주세요.",
      "lang": "ko-KR",
      "volume": 75
    }
    ```

## 2. 하드웨어 측 구현 (C++/Arduino)
S3 BOX는 ESP-RS(Speech Recognition) 및 TTS 엔진을 내장하고 있습니다.

### 핵심 라이브러리
*   **ESP-SR**: 음성 인식 및 합성 엔진.
*   **ESP-ADF**: 오디오 데이터 흐름 관리.

### 하드웨어 처리 프로세스
1.  **MQTT 메시지 수신**: `smartfarm/gateway/audio_play` 토픽 구독.
2.  **JSON 파싱**: `text` 필드 추출.
3.  **TTS 엔진 호출**: 내장된 음성 합성 함수 실행.
    ```cpp
    // 개념 예시 코드
    void handleTTS(String text) {
        // ESP-SR의 TTS 엔진을 이용해 스피커(I2S)로 출력
        esp_tts_voice_t *voice = esp_tts_voice_female_kr; // 한국어 여성 목소리 선택
        esp_tts_speak(voice, text.c_str()); 
    }
    ```

## 3. TTS 방식의 장점 vs 단점

| 구분 | 동적 TTS (추천) | 미리 녹음된 MP3 방식 |
| :--- | :--- | :--- |
| **유연성** | 무한한 문장 생성 가능 | 녹음된 문장만 가능 |
| **용량** | 텍스트만 전송 (Bytes) | 파일 단위 전송 (KBytes/MBytes) |
| **반응 속도** | 즉각적 | 다운로드 또는 로딩 시간 필요 |
| **품질** | 다소 기계적일 수 있음 | 매우 자연스러움 |

## 4. 실전 활용 시나리오
*   **센서 리딩**: "현재 온도는 25.4도입니다." (전달받은 숫자를 즉석에서 읽음)
*   **작업 안내**: "오전 10시 30분입니다. 영양제 투입 시간입니다."
*   **에러 상세 보고**: "와이파이 연결이 불안정하여 3번 노드와 통신이 끊겼습니다."

---
**Tip**: ESP32-S3 BOX의 고성능 칩셋 덕분에 이러한 처리를 인터넷 연결 없이 기기 자체적으로 수행할 수 있어, 네트워크 장애 시에도 안정적인 안내가 가능합니다.
