<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>ë ˆì‹œí”¼ ê´€ë¦¬ (Recipe) - SmartFarm</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --bg-dark: #050505;
            --bg-panel: rgba(20, 20, 25, 0.6);
            --primary: #00f2ff;
            --secondary: #7000ff;
            --success: #00ff9d;
            --warning: #ffb800;
            --danger: #ff0055;
            --text-main: #ffffff;
            --text-muted: #8899ac;
            --border: rgba(255, 255, 255, 0.08);
            --glass: blur(20px);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
        }

        /* --- Premium Pull-down Navigation --- */
        .top-navbar {
            height: 60px;
            background: rgba(10, 10, 12, 0.95);
            backdrop-filter: blur(25px);
            border-bottom: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 1.5rem;
            position: sticky;
            top: 0;
            z-index: 3000;
        }

        .logo {
            font-weight: 800;
            font-size: 1.3rem;
            letter-spacing: -0.5px;
            color: var(--text-main);
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .logo span {
            color: var(--primary);
        }

        .nav-links {
            display: flex;
            gap: 0.5rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-muted);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.85rem;
            padding: 0.5rem 0.8rem;
            border-radius: 8px;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .nav-item:hover,
        .nav-item.active {
            color: var(--text-main);
            background: rgba(255, 255, 255, 0.05);
        }

        /* Mobile Menu (Pull-down Overlay) */
        .mobile-menu-overlay {
            position: fixed;
            top: -100%;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(5, 5, 8, 0.98);
            backdrop-filter: blur(30px);
            z-index: 2500;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 1.5rem;
            transition: top 0.5s cubic-bezier(0.7, 0, 0.3, 1);
            opacity: 0;
        }

        .mobile-menu-overlay.open {
            top: 0;
            opacity: 1;
        }

        .mobile-nav-item {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-muted);
            text-decoration: none;
            transition: color 0.3s;
        }

        .mobile-nav-item:hover,
        .mobile-nav-item.active {
            color: var(--primary);
        }

        .mobile-toggle {
            display: none;
            width: 40px;
            height: 40px;
            cursor: pointer;
            align-items: center;
            justify-content: center;
            color: var(--text-main);
            position: relative;
            z-index: 3100;
        }

        /* --- Main Content (Mobile-First) --- */
        .main-content {
            flex: 1;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        header {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }

            .mobile-toggle {
                display: flex;
            }
        }

        @media (min-width: 769px) {
            .main-content {
                padding: 2rem;
            }

            header {
                flex-direction: row !important;
                justify-content: space-between;
                align-items: center;
            }
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, #fff, #aaa);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .page-title p {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        button {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: white;
            padding: 10px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        button:hover {
            background: var(--primary);
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(46, 204, 113, 0.2);
        }

        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .crop-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(15px);
            transition: transform 0.3s ease;
        }

        .crop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 15px;
        }

        .crop-name {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--primary);
            text-transform: capitalize;
        }

        .stage-section {
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 15px;
        }

        .stage-title {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
        }

        .param-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .param-name {
            color: rgba(255, 255, 255, 0.8);
        }

        .param-value {
            font-family: 'Outfit', sans-serif;
            color: var(--accent);
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: #1E293B;
            padding: 40px;
            border-radius: 24px;
            width: 100%;
            max-width: 500px;
            border: 1px solid var(--border);
        }

        input {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: white;
            margin-top: 5px;
            margin-bottom: 15px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 30px;
            border-radius: 12px;
            background: var(--primary);
            font-weight: 600;
            transform: translateY(100px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateY(0);
        }
    </style>
</head>

<body>
    <!-- Top Navigation Bar -->
    <nav class="top-navbar">
        <div class="logo" onclick="location.href='/'">
            <i data-lucide="leaf" style="color:var(--primary)"></i>
            <span>MQ</span>net SmartFarm
        </div>

        <div class="nav-links">
            <a href="index.html" class="nav-item">ëŒ€ì‹œë³´ë“œ</a>
            <a href="cctv.html" class="nav-item">CCTV</a>
            <a href="dashboard.html" class="nav-item">ëª¨ë‹ˆí„°ë§</a>
            <a href="history.html" class="nav-item">ë¶„ì„ì¼ì§€</a>
            <a href="infra_tree.html" class="nav-item">ì¸í”„ë¼</a>
            <a href="recipe_manager.html" class="nav-item active">ìë™í™”</a>
        </div>

        <div class="mobile-toggle" id="menu-toggle">
            <i data-lucide="menu" id="menu-icon"></i>
        </div>
    </nav>

    <!-- Premium Pull-down Mobile Overlay -->
    <div class="mobile-menu-overlay" id="mobile-menu">
        <a href="index.html" class="mobile-nav-item">ëŒ€ì‹œë³´ë“œ</a>
        <a href="cctv.html" class="mobile-nav-item">ì‹¤ì‹œê°„ CCTV</a>
        <a href="dashboard.html" class="mobile-nav-item">ì„¼ì„œ ëª¨ë‹ˆí„°ë§</a>
        <a href="history.html" class="mobile-nav-item">ë°ì´í„° ë¶„ì„ì¼ì§€</a>
        <a href="infra_tree.html" class="mobile-nav-item">ì¸í”„ë¼ ê´€ë¦¬</a>
        <a href="recipe_manager.html" class="mobile-nav-item active">ìë™í™” ì„¤ì •</a>
        <a href="help.html" class="mobile-nav-item">ë„ì›€ë§ Center</a>
    </div>

    <main class="main-content">
        <header>
            <div class="page-title">
                <h1>ì‘ë¬¼ ë ˆì‹œí”¼ ê´€ë¦¬ (Recipe Manager)</h1>
                <p>Plant Growth Recipe & Automation Presets</p>
            </div>
            <div style="display: flex; gap: 10px;">
                <button onclick="copyRecipeJson()"
                    style="background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: white; padding: 10px 20px; border-radius: 12px; cursor: pointer; font-weight: 600; transition: all 0.3s; backdrop-filter: blur(10px);">ğŸ“‹
                    íŒŒì¼ êµ¬ì¡° ë³µì‚¬</button>
                <button onclick="downloadRecipeJson()"
                    style="background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: white; padding: 10px 20px; border-radius: 12px; cursor: pointer; font-weight: 600; transition: all 0.3s; backdrop-filter: blur(10px);">ğŸ’¾
                    íŒŒì¼ ì €ì¥</button>
                <button onclick="showAddModal()"
                    style="background: var(--primary); border: none; color: #000; padding: 10px 20px; border-radius: 12px; cursor: pointer; font-weight: 700; transition: all 0.3s; box-shadow: 0 0 20px rgba(0, 242, 255, 0.3);">+
                    ìƒˆ ë ˆì‹œí”¼ ì¶”ê°€</button>
            </div>
        </header>

        <div id="recipeGrid" class="recipe-grid">
            <!-- Loaded via JS -->
        </div>
    </main>

    <!-- Edit Modal (Simplified for demo) -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">ë ˆì‹œí”¼ ìˆ˜ì •/ì¶”ê°€</h2>
            <br>
            <label>ì‘ë¬¼ ì´ë¦„ (Crop Name)</label>
            <input type="text" id="cropName" placeholder="ì˜ˆ: lettuce">
            <label>ìƒìœ¡ ë‹¨ê³„ (Stage)</label>
            <input type="text" id="stageName" placeholder="ì˜ˆ: growth">

            <div class="form-row">
                <div style="flex:1">
                    <label>ì˜¨ë„ ìµœì†Œê°’ (Temp Min) â„ƒ</label>
                    <input type="number" id="tempMin" step="0.1">
                </div>
                <div style="flex:1">
                    <label>ì˜¨ë„ ìµœëŒ€ê°’ (Temp Max) â„ƒ</label>
                    <input type="number" id="tempMax" step="0.1">
                </div>
            </div>
            <div class="form-row">
                <div style="flex:1">
                    <label>pH ìµœì†Œê°’ (pH Min)</label>
                    <input type="number" id="phMin" step="0.1">
                </div>
                <div style="flex:1">
                    <label>pH ìµœëŒ€ê°’ (pH Max)</label>
                    <input type="number" id="phMax" step="0.1">
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button style="flex: 1; background: var(--primary);" onclick="saveRecipe()">ì €ì¥ (Save)</button>
                <button style="flex: 1;" onclick="hideModal()">ì·¨ì†Œ (Cancel)</button>
            </div>
        </div>
    </div>

    <div id="noti" class="notification">ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! (Saved)</div>

    <script>
        let catalog = {};

        async function loadCatalog() {
            try {
                const res = await fetch('/data/catalog_crop.json');
                catalog = await res.json();
                renderCatalog();
            } catch (e) {
                console.error("Failed to load catalog", e);
            }
        }

        function renderCatalog() {
            const grid = document.getElementById('recipeGrid');
            grid.innerHTML = '';

            for (const [crop, stages] of Object.entries(catalog)) {
                const card = document.createElement('div');
                card.className = 'crop-card';

                let stagesHtml = '';
                for (const [stage, params] of Object.entries(stages)) {
                    stagesHtml += `
                        <div class="stage-section">
                            <div class="stage-title">
                                <span>ë‹¨ê³„: ${stage.toUpperCase()}</span>
                                <span style="cursor:pointer;color:var(--secondary)" onclick="editStage('${crop}', '${stage}')">ìˆ˜ì • (Edit)</span>
                            </div>
                            ${Object.entries(params).map(([key, val]) => `
                                <div class="param-row">
                                    <span class="param-name">${key}</span>
                                    <span class="param-value">${val.min} ~ ${val.max}</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                card.innerHTML = `
                    <div class="crop-header">
                        <span class="crop-name">${crop}</span>
                    </div>
                    ${stagesHtml}
                `;
                grid.appendChild(card);
            }
        }

        function showAddModal() {
            document.getElementById('modalTitle').innerText = 'Add New Recipe';
            document.getElementById('cropName').value = '';
            document.getElementById('stageName').value = '';
            document.getElementById('tempMin').value = '';
            document.getElementById('tempMax').value = '';
            document.getElementById('phMin').value = '';
            document.getElementById('phMax').value = '';
            document.getElementById('editModal').style.display = 'flex';
        }

        function hideModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        function editStage(crop, stage) {
            document.getElementById('modalTitle').innerText = `Edit: ${crop}.${stage}`;
            document.getElementById('cropName').value = crop;
            document.getElementById('stageName').value = stage;

            const params = catalog[crop][stage];
            document.getElementById('tempMin').value = params.Temp?.min || 0;
            document.getElementById('tempMax').value = params.Temp?.max || 0;
            document.getElementById('phMin').value = params.pH?.min || 0;
            document.getElementById('phMax').value = params.pH?.max || 0;

            document.getElementById('editModal').style.display = 'flex';
        }

        async function saveRecipe() {
            const crop = document.getElementById('cropName').value.toLowerCase();
            const stage = document.getElementById('stageName').value.toLowerCase();

            if (!catalog[crop]) catalog[crop] = {};
            catalog[crop][stage] = {
                "Temp": {
                    min: parseFloat(document.getElementById('tempMin').value),
                    max: parseFloat(document.getElementById('tempMax').value)
                },
                "pH": {
                    min: parseFloat(document.getElementById('phMin').value),
                    max: parseFloat(document.getElementById('phMax').value)
                }
            };

            // In a real app, you'd send a POST request to update the JSON file.
            // For this demo, we local update and show notification.
            renderCatalog();
            hideModal();
            showNotification();
        }


        function copyRecipeJson() {
            navigator.clipboard.writeText(JSON.stringify(catalog, null, 4)).then(() => {
                const noti = document.getElementById('noti');
                noti.textContent = "JSON Copied to Clipboard!";
                showNotification();
            });
        }

        function downloadRecipeJson() {
            const blob = new Blob([JSON.stringify(catalog, null, 4)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = "catalog_crop.json";
            a.click();
            URL.revokeObjectURL(url);
        }

        function showNotification() {
            const noti = document.getElementById('noti');
            noti.classList.add('show');
            setTimeout(() => noti.classList.remove('show'), 3000);
        }

        // Premium Pull-down Menu Toggle
        const menuToggle = document.getElementById('menu-toggle');
        const mobileMenu = document.getElementById('mobile-menu');
        const menuIcon = document.getElementById('menu-icon');

        if (menuToggle) {
            menuToggle.addEventListener('click', () => {
                const isOpen = mobileMenu.classList.toggle('open');
                menuIcon.setAttribute('data-lucide', isOpen ? 'x' : 'menu');
                lucide.createIcons();
                document.body.style.overflow = isOpen ? 'hidden' : 'auto';
            });
        }

        lucide.createIcons();
        loadCatalog();
    </script>
</body>

</html>