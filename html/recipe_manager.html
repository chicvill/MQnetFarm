<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SmartFarm | Recipe Manager</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root {
            --bg-dark: #050505;
            --bg-panel: rgba(20, 20, 25, 0.6);
            --primary: #00f2ff;
            --secondary: #7000ff;
            --success: #00ff9d;
            --warning: #ffb800;
            --danger: #ff0055;
            --text-main: #ffffff;
            --text-muted: #8899ac;
            --border: rgba(255, 255, 255, 0.08);
            --glass: blur(20px);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            user-select: none;
        }

        body {
            background-color: var(--bg-dark);
            background-image:
                radial-gradient(circle at 10% 20%, rgba(112, 0, 255, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 90% 80%, rgba(0, 242, 255, 0.05) 0%, transparent 40%);
            color: var(--text-main);
            min-height: 100vh;
            display: flex;
            overflow: hidden;
        }

        /* --- Sidebar Navigation --- */
        .sidebar {
            width: 80px;
            background: rgba(10, 10, 12, 0.8);
            backdrop-filter: var(--glass);
            border-right: 1px solid var(--border);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem 0;
            z-index: 100;
            transition: width 0.3s ease;
        }

        .sidebar:hover {
            width: 240px;
        }

        .logo {
            width: auto;
            height: 40px;
            background: transparent;
            border-radius: 0;
            margin-bottom: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.5rem;
            box-shadow: none;
            flex-shrink: 0;
            letter-spacing: -1px;
            color: var(--text-main);
            text-shadow: 0 0 15px rgba(0, 242, 255, 0.4);
            font-family: 'Outfit', sans-serif;
            padding: 0 5px;
        }

        .logo span {
            color: var(--primary);
        }

        .nav-item {
            width: 100%;
            height: 50px;
            display: flex;
            align-items: center;
            padding: 0 1.5rem;
            color: var(--text-muted);
            text-decoration: none;
            transition: all 0.2s;
            position: relative;
            cursor: pointer;
            margin-bottom: 0.5rem;
        }

        .nav-item:hover,
        .nav-item.active {
            color: var(--text-main);
            background: linear-gradient(90deg, rgba(255, 255, 255, 0.03), transparent);
        }

        .nav-item.active::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 3px;
            background: var(--primary);
            box-shadow: 0 0 10px var(--primary);
        }

        .nav-icon {
            margin-right: 1.5rem;
            flex-shrink: 0;
        }

        .nav-label {
            opacity: 0;
            white-space: nowrap;
            transition: opacity 0.2s;
            font-weight: 500;
        }

        .sidebar:hover .nav-label {
            opacity: 1;
            transition-delay: 0.1s;
        }

        /* --- Main Content --- */
        .main-content {
            flex: 1;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 2rem;
            overflow-y: auto;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-title h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(90deg, #fff, #aaa);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .page-title p {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        button {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            color: white;
            padding: 10px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        button:hover {
            background: var(--primary);
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(46, 204, 113, 0.2);
        }

        .recipe-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .crop-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 20px;
            padding: 25px;
            backdrop-filter: blur(15px);
            transition: transform 0.3s ease;
        }

        .crop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid var(--border);
            padding-bottom: 15px;
        }

        .crop-name {
            font-size: 1.4rem;
            font-weight: 600;
            color: var(--primary);
            text-transform: capitalize;
        }

        .stage-section {
            margin-bottom: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            padding: 15px;
        }

        .stage-title {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
        }

        .param-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.95rem;
        }

        .param-name {
            color: rgba(255, 255, 255, 0.8);
        }

        .param-value {
            font-family: 'Outfit', sans-serif;
            color: var(--accent);
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: #1E293B;
            padding: 40px;
            border-radius: 24px;
            width: 100%;
            max-width: 500px;
            border: 1px solid var(--border);
        }

        input {
            width: 100%;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: white;
            margin-top: 5px;
            margin-bottom: 15px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .notification {
            position: fixed;
            bottom: 30px;
            right: 30px;
            padding: 15px 30px;
            border-radius: 12px;
            background: var(--primary);
            font-weight: 600;
            transform: translateY(100px);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateY(0);
        }
    </style>
</head>

<body>
    <nav class="sidebar">
        <div class="logo"><span>MQ</span>net</div>
        <a href="index.html" class="nav-item">
            <i data-lucide="layout-dashboard" class="nav-icon"></i>
            <span class="nav-label">ëŒ€ì‹œë³´ë“œ (Overview)</span>
        </a>
        <a href="cctv.html" class="nav-item">
            <i data-lucide="camera" class="nav-icon"></i>
            <span class="nav-label">ì˜ìƒ ê´€ì œ (CCTV)</span>
        </a>
        <a href="dashboard.html" class="nav-item">
            <i data-lucide="activity" class="nav-icon"></i>
            <span class="nav-label">ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°</span>
        </a>
        <a href="history.html" class="nav-item">
            <i data-lucide="file-text" class="nav-icon"></i>
            <span class="nav-label">ë¶„ì„ ë° ì¼ì§€</span>
        </a>
        <a href="help.html" class="nav-item">
            <i data-lucide="help-circle" class="nav-icon"></i>
            <span class="nav-label">ë„ì›€ë§ (Help)</span>
        </a>
        <a href="infra_tree.html" class="nav-item">
            <i data-lucide="network" class="nav-icon"></i>
            <span class="nav-label">ì¸í”„ë¼ ê´€ë¦¬</span>
        </a>
        <a href="configurator.html" class="nav-item">
            <i data-lucide="settings" class="nav-icon"></i>
            <span class="nav-label">ì¥ì¹˜ ì„¤ì •</span>
        </a>
        <a href="recipe_manager.html" class="nav-item active">
            <i data-lucide="workflow" class="nav-icon"></i>
            <span class="nav-label">ìë™í™”/ë ˆì‹œí”¼</span>
        </a>
    </nav>

    <main class="main-content">
        <header>
            <div class="page-title">
                <h1>ì‘ë¬¼ ë ˆì‹œí”¼ ê´€ë¦¬ (Recipe Manager)</h1>
                <p>Plant Growth Recipe & Automation Presets</p>
            </div>
            <div style="display: flex; gap: 10px;">
                <button onclick="copyRecipeJson()"
                    style="background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: white; padding: 10px 20px; border-radius: 12px; cursor: pointer; font-weight: 600; transition: all 0.3s; backdrop-filter: blur(10px);">ğŸ“‹
                    íŒŒì¼ êµ¬ì¡° ë³µì‚¬</button>
                <button onclick="downloadRecipeJson()"
                    style="background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: white; padding: 10px 20px; border-radius: 12px; cursor: pointer; font-weight: 600; transition: all 0.3s; backdrop-filter: blur(10px);">ğŸ’¾
                    íŒŒì¼ ì €ì¥</button>
                <button onclick="showAddModal()"
                    style="background: var(--primary); border: none; color: #000; padding: 10px 20px; border-radius: 12px; cursor: pointer; font-weight: 700; transition: all 0.3s; box-shadow: 0 0 20px rgba(0, 242, 255, 0.3);">+
                    ìƒˆ ë ˆì‹œí”¼ ì¶”ê°€</button>
            </div>
        </header>

        <div id="recipeGrid" class="recipe-grid">
            <!-- Loaded via JS -->
        </div>
    </main>

    <!-- Edit Modal (Simplified for demo) -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <h2 id="modalTitle">ë ˆì‹œí”¼ ìˆ˜ì •/ì¶”ê°€</h2>
            <br>
            <label>ì‘ë¬¼ ì´ë¦„ (Crop Name)</label>
            <input type="text" id="cropName" placeholder="ì˜ˆ: lettuce">
            <label>ìƒìœ¡ ë‹¨ê³„ (Stage)</label>
            <input type="text" id="stageName" placeholder="ì˜ˆ: growth">

            <div class="form-row">
                <div style="flex:1">
                    <label>ì˜¨ë„ ìµœì†Œê°’ (Temp Min) â„ƒ</label>
                    <input type="number" id="tempMin" step="0.1">
                </div>
                <div style="flex:1">
                    <label>ì˜¨ë„ ìµœëŒ€ê°’ (Temp Max) â„ƒ</label>
                    <input type="number" id="tempMax" step="0.1">
                </div>
            </div>
            <div class="form-row">
                <div style="flex:1">
                    <label>pH ìµœì†Œê°’ (pH Min)</label>
                    <input type="number" id="phMin" step="0.1">
                </div>
                <div style="flex:1">
                    <label>pH ìµœëŒ€ê°’ (pH Max)</label>
                    <input type="number" id="phMax" step="0.1">
                </div>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 20px;">
                <button style="flex: 1; background: var(--primary);" onclick="saveRecipe()">ì €ì¥ (Save)</button>
                <button style="flex: 1;" onclick="hideModal()">ì·¨ì†Œ (Cancel)</button>
            </div>
        </div>
    </div>

    <div id="noti" class="notification">ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤! (Saved)</div>

    <script>
        let catalog = {};

        async function loadCatalog() {
            try {
                const res = await fetch('/data/catalog_crop.json');
                catalog = await res.json();
                renderCatalog();
            } catch (e) {
                console.error("Failed to load catalog", e);
            }
        }

        function renderCatalog() {
            const grid = document.getElementById('recipeGrid');
            grid.innerHTML = '';

            for (const [crop, stages] of Object.entries(catalog)) {
                const card = document.createElement('div');
                card.className = 'crop-card';

                let stagesHtml = '';
                for (const [stage, params] of Object.entries(stages)) {
                    stagesHtml += `
                        <div class="stage-section">
                            <div class="stage-title">
                                <span>ë‹¨ê³„: ${stage.toUpperCase()}</span>
                                <span style="cursor:pointer;color:var(--secondary)" onclick="editStage('${crop}', '${stage}')">ìˆ˜ì • (Edit)</span>
                            </div>
                            ${Object.entries(params).map(([key, val]) => `
                                <div class="param-row">
                                    <span class="param-name">${key}</span>
                                    <span class="param-value">${val.min} ~ ${val.max}</span>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                card.innerHTML = `
                    <div class="crop-header">
                        <span class="crop-name">${crop}</span>
                    </div>
                    ${stagesHtml}
                `;
                grid.appendChild(card);
            }
        }

        function showAddModal() {
            document.getElementById('modalTitle').innerText = 'Add New Recipe';
            document.getElementById('cropName').value = '';
            document.getElementById('stageName').value = '';
            document.getElementById('tempMin').value = '';
            document.getElementById('tempMax').value = '';
            document.getElementById('phMin').value = '';
            document.getElementById('phMax').value = '';
            document.getElementById('editModal').style.display = 'flex';
        }

        function hideModal() {
            document.getElementById('editModal').style.display = 'none';
        }

        function editStage(crop, stage) {
            document.getElementById('modalTitle').innerText = `Edit: ${crop}.${stage}`;
            document.getElementById('cropName').value = crop;
            document.getElementById('stageName').value = stage;

            const params = catalog[crop][stage];
            document.getElementById('tempMin').value = params.Temp?.min || 0;
            document.getElementById('tempMax').value = params.Temp?.max || 0;
            document.getElementById('phMin').value = params.pH?.min || 0;
            document.getElementById('phMax').value = params.pH?.max || 0;

            document.getElementById('editModal').style.display = 'flex';
        }

        async function saveRecipe() {
            const crop = document.getElementById('cropName').value.toLowerCase();
            const stage = document.getElementById('stageName').value.toLowerCase();

            if (!catalog[crop]) catalog[crop] = {};
            catalog[crop][stage] = {
                "Temp": {
                    min: parseFloat(document.getElementById('tempMin').value),
                    max: parseFloat(document.getElementById('tempMax').value)
                },
                "pH": {
                    min: parseFloat(document.getElementById('phMin').value),
                    max: parseFloat(document.getElementById('phMax').value)
                }
            };

            // In a real app, you'd send a POST request to update the JSON file.
            // For this demo, we local update and show notification.
            renderCatalog();
            hideModal();
            showNotification();
        }


        function copyRecipeJson() {
            navigator.clipboard.writeText(JSON.stringify(catalog, null, 4)).then(() => {
                const noti = document.getElementById('noti');
                noti.textContent = "JSON Copied to Clipboard!";
                showNotification();
            });
        }

        function downloadRecipeJson() {
            const blob = new Blob([JSON.stringify(catalog, null, 4)], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = "catalog_crop.json";
            a.click();
            URL.revokeObjectURL(url);
        }

        function showNotification() {
            const noti = document.getElementById('noti');
            noti.classList.add('show');
            setTimeout(() => noti.classList.remove('show'), 3000);
        }

        loadCatalog();
    </script>
</body>

</html>