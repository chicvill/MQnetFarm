# 📘 SmartFarm Live - 사용자 매뉴얼 (User Manual)
**Version 1.0 (2026-02-20)**  
**Developer:** Antigravity AI Team

---

## 1. 시스템 개요 (Introduction)
SmartFarm Live는 **데이터 수집(IoT), 영상 분석(AI Vision), 자동 제어(Automation)**가 통합된 **차세대 스마트팜 관리 시스템**입니다.  
사용자는 **웹 브라우저 하나로** 농장의 모든 상황을 실시간으로 감시하고, 과거 데이터를 분석하며, AI를 통해 작물의 생장 상태까지 정밀하게 관리할 수 있습니다.

**[주요 특징]**
*   ⏱️ **2초 주기 초고속 갱신**: 모든 센서 데이터가 실시간으로 반영됩니다.
*   🚨 **재난/비상 대응 시스템**: 화재, 침입, 장치 고장을 즉시 감지하고 경보를 울립니다.
*   👁️ **AI Vision 생육 분석**: CCTV 화면만으로 식물이 얼마나 자랐는지(%) 자동 분석합니다.
*   📊 **빅데이터 기록 및 시각화**: 모든 환경 데이터와 생장 기록이 영구 저장됩니다.

---

## 2. 대시보드 (Overview) - `index.html`
시스템에 처음 접속하면 보이는 메인 관제탑입니다.

### 🔍 주요 기능
1.  **실시간 모니터링 (Live Status)**:
    *   화면 중앙의 타일들은 각 구역(Zone)의 현재 센서값입니다.
    *   정상 범위(초록색)를 벗어나면 **노란색(Warning)** 또는 **빨간색(Danger)**으로 변하며 깜빡입니다.
    *   예: "습도 20% 이하" -> **건조 경보 발생**

2.  **장치 상태 진단 (Device Health Check)**:
    *   우측 패널의 **[Device Status]** 카드에서 장비의 건강 상태를 확인합니다.
    *   `Heartbeat`: 통신이 끊기지 않았는지 (핑 테스트)
    *   `Sensor`: 데이터가 비정상적으로 튀지 않는지 (무결성)
    *   `Power`: 배터리 전압이 안정적인지 (12V 기준)

3.  **🚨 긴급 시뮬레이션 (Emergency Test)**:
    *   우측 **[Disaster Simulation]** 버튼들을 눌러 비상 상황을 테스트해 볼 수 있습니다.
    *   **[🔥 FIRE]**: 화재 감지 시 적색 경보등 점멸 + 사이렌 소리.
    *   **[🚫 INTRUSION]**: 외부인 침입 감지 시 보안 경보.
    *   **[🌪️ STORM]**: 태풍 모드 (모든 창문/환기팬 자동 폐쇄).

---

## 3. 영상 관제 (CCTV & AI Vision) - `cctv.html`
농장의 눈이 되어주는 CCTV 관리 및 AI 분석 페이지입니다.

### 👁️ 실시간 보기 및 관리
*   **확대 보기**: 카메라 화면을 클릭하면 **전체 화면**으로 크게 볼 수 있습니다.
*   **카메라 추가**: **[+ 카메라 추가]** 버튼을 눌러 새 카메라(RTSP/HTTP URL)를 등록할 수 있습니다.
    *   추천: `ESP32-CAM`, `IP Webcam` (안드로이드 앱), `Tapo` 등

### 🌱 AI 생육 분석 (핵심 기능)
이 시스템의 가장 강력한 기능 중 하나입니다.
1.  카메라 카드 하단의 **[🌱] (새싹 아이콘)** 버튼을 클릭합니다.
2.  **AI Vision Engine**이 현재 화면을 캡처하여 분석합니다.
3.  **결과 팝업**:
    *   **분석 이미지**: 식물 영역만 **초록색 마스크**로 표시됩니다.
    *   **생장률 (%)**: 전체 화면 대비 식물이 차지하는 면적 비율입니다.
    *   **AI Insight**: "수확 시기가 임박했습니다" 등의 조언을 제공합니다.
4.  분석 결과는 자동으로 **[성장 기록]**에 저장됩니다.

---

## 4. 분석 및 일지 (Analytics & Journal) - `history.html`
과거의 데이터를 조회하고 농장 운영 기록을 남기는 곳입니다.

### 📈 데이터 시각화
1.  **환경 데이터 추세 (Temp & Humidity)**:
    *   상단 날짜 선택기에서 **원하는 날짜**를 선택합니다. (기본값: 오늘)
    *   **[조회]** 버튼 또는 날짜 변경 시 그래프가 자동 갱신됩니다.
    *   과거의 온도/습도 변화를 꺾은선 그래프로 비교 분석할 수 있습니다.

2.  **생육 비교 (Growth vs Energy)**:
    *   CCTV에서 **[🌱 분석]**을 수행했던 기록들이 여기에 누적됩니다.
    *   **날짜별 생장률(%)**이 막대 그래프로 표시되어, 작물이 얼마나 빨리 자라는지 시각적으로 확인합니다.

### 📝 스마트 영농 일지
*   **일지 작성**: "작업(Maintenance)", "수확(Harvest)", "방제(Pest Control)" 타입을 선택하고 내용을 입력합니다.
*   **[+ 기록]**: 버튼을 누르면 서버에 **영구 저장**됩니다. (새로고침 해도 사라지지 않음)

---

## 5. 인프라 및 자동화 - `infra_tree.html`, `recipe.html`
*   **인프라 관리**: 농장의 네트워크 구조(게이트웨이 <-> 노드 <-> 센서)를 트리 형태로 봅니다.
*   **장치 설정**: 각 센서의 **이름, 임계값(Alert Threshold), 핀 번호**를 수정할 수 있습니다.
*   **자동화 레시피**: "온도가 30도 넘으면 -> 팬을 켠다" 같은 **IF-THEN 규칙**을 만듭니다.

---

## 6. Docker 환경에서 실행하기 (Run with Docker)
Docker를 사용하여 더욱 안정적이고 독립된 환경에서 시스템을 실행할 수 있습니다.

### 🐳 실행 방법
1.  **Docker Desktop**이 설치되어 있어야 합니다.
2.  터미널에서 다음 명령어를 실행합니다:
    ```bash
    .\run_docker.bat
    ```
    또는
    ```bash
    docker-compose up --build -d
    ```
3.  브라우저에서 `http://localhost:8000`으로 접속합니다.

### 💾 데이터 영구 저장 (Data Persistence)
*   모든 설정 파일(`config.json`)과 데이터 파일(`smartfarm_tsdb.csv`, `growth_log.json` 등)은 `./data` 폴더에 저장됩니다.
*   Docker 컨테이너를 재시작하거나 삭제해도, **`./data` 폴더의 내용은 보존됩니다.**
*   (참고) 기존의 `smartfarm_tsdb.csv` 파일은 이제 `data/` 폴더로 이동되었습니다.

---

## 🛠️ 문제 해결 (Troubleshooting)

### Q1. 사이트에 연결할 수 없거나 무한 로딩이 걸려요.
*   **원인**: 서버가 꺼져 있거나, 포트 충돌이 발생했습니다.
*   **해결**:
    1.  VS Code 터미널에서 `Ctrl + C`를 눌러 현재 프로세스를 완전히 종료합니다.
    2.  `.\run` 명령어를 다시 입력하여 서버를 **깨끗하게 재시작**합니다.
    3.  `[1/2] Chrome 브라우저 실행...` 메시지가 뜨면 성공입니다.

### Q2. "Vision Module Not Loaded" 오류가 떠요.
*   **원인**: Python 라이브러리(`opencv-python`)가 설치되지 않은 환경에서 실행 중입니다.
*   **해결**: `.\run` 스크립트를 재실행하세요. 최신 버전의 `run.bat`는 실행 시 자동으로 필요 라이브러리를 설치합니다.

### Q3. 그래프에 데이터가 안 나와요.
*   **원인**: 선택한 날짜에 저장된 데이터(`smartfarm_tsdb.csv`)가 없기 때문입니다.
*   **해결**: 시뮬레이터를 켜두고 몇 분 기다리거나, 데이터가 확실히 있는 **과거 날짜(예: 어제)**를 선택해 보세요.

---

### 💡 팁 (Tips)
*   **전체 화면 모드**: 대시보드를 켜두고 `F11`을 누르면 **관제 상황실**처럼 멋진 모니터링 화면이 됩니다.
*   **모바일 지원**: 같은 와이파이에 연결된 스마트폰 브라우저에 `http://PC_IP주소:8000`을 입력하면 폰에서도 제어가 가능합니다.

---
**문의 및 지원**: `support@antigravity.ai`
